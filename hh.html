<!-- Ajoutez ceci dans votre fichier HTML -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/vfs_fonts.js"></script>

<style>
  .pagination-container {
  display: flex;
  justify-content: center;
  align-items: center;
}

.pagination-button {
  background-color: #00acd6;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px 15px;
    cursor: pointer;
    margin: 0 0px;
    font-size: 8px;
    transition: background-color 0.3s ease;
}

.pagination-button:hover {
  background-color: #0056b3; /* Couleur du bouton au survol */
}

.pagination-number {
  font-size: 20px; /* Taille du numéro de page */
  margin: 0 20px;
  font-weight: bold;
  color: #333; /* Couleur du numéro de page */
}

  /* Backdrop pour l'effet flou de l'arrière-plan */
.loading-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5); /* Couche de fond semi-transparente */
  backdrop-filter: blur(5px); /* Effet de flou */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999; /* Assure que le loader est au-dessus de tout */
}

/* Conteneur pour le contenu du loader */
.loading-content {
  background: white; /* Fond blanc du conteneur */
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* Ombres pour donner de la profondeur */
  text-align: center;
}

/* Icône de chargement */
.loading-icon i {
  font-size: 50px;
  color: #1a73e8; /* Couleur bleu pour l'icône */
  margin-bottom: 20px;
}

/* Style du titre */
.loading-title {
  font-size: 24px;
  font-weight: bold;
  color: #333;
  margin-bottom: 10px;
}

/* Style du texte */
.loading-text {
  font-size: 18px;
  color: #666;
}


.title-commandes {
  font-size: 20px;
  font-weight: bold;
  color: #1a73e8; /* Couleur bleu pour signifier l'importance */
  text-transform: uppercase; /* Mettre le texte en majuscules */
  letter-spacing: 1.5px; /* Espacement des lettres pour aérer le titre */
  margin-bottom: 10px; /* Espacement en dessous du titre */
  border-bottom: 2px solid #1a73e8; /* Ligne en dessous du titre pour délimiter */
  padding-bottom: 5px;
}


.title-nouvelle-facture {
  font-size: 20px;
  font-weight: 600;
  color: #34a853; /* Vert pour signaler une nouvelle facture */
  font-style: italic; /* Texte en italique pour un effet distinct */
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1); /* Légère ombre pour donner de la profondeur */
  margin-bottom: 12px;
}

.title-recherche-commande {
  font-size: 20px;
  font-weight: 600;
  color: #ea4335; /* Rouge pour attirer l'attention sur la recherche */
  border-left: 5px solid #ea4335; /* Bordure rouge à gauche pour mettre en valeur */
  padding-left: 10px; /* Espacement entre la bordure et le texte */
  text-transform: capitalize; /* Capitaliser chaque mot */
  margin-bottom: 15px;
}


.search-container {
  position: relative;
    width: 27%;
    display: flex;
    margin-left: 20px;
}

.search-container input {
  margin-bottom: 20px;
    width: 102%;
    padding: 12px 23px 9px 58px;
    font-size: 16px;
    border-radius: 25px;
    border: 2px solid #4CAF50;
    background-color: #f9f9f9;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    outline: none;
    transition: all 0.3s ease;
}

.search-container input:focus {
  border-color: #45a049;
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
  background-color: #fff;
}

.search-container input::placeholder {
  color: #999;
}

.search-icon {
  position: absolute;
  left: 15px;
  top: 46%;
  transform: translateY(-50%);
  font-size: 18px;
  color: #4CAF50; /* Vert */
}

.search-container input:focus + .search-icon {
  color: #45a049;
}

.radio-group {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
}

/* Hide the default radio button */
.custom-radio input[type="radio"] {
  display: none;
}

/* Style the label for custom radio buttons */
.custom-radio {
  display: flex;
  align-items: center;
  cursor: pointer;
  margin: 0 10px;
  transition: all 0.3s ease;
}

/* Radio icon styles */
.radio-icon {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

/* Radio label */
.radio-label {
  font-size: 16px;
}

/* Colors for different statuses */
.not-found {
  background-color: lightblue;
}

.verified {
  background-color: lightgreen;
}

.not-verified {
  background-color: lightcoral;
}

/* Adding shadow and changing size when selected */
.custom-radio input[type="radio"]:checked + .radio-icon {
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
  transform: scale(1.2);
}

.badge-prefacture {
    position: absolute; /* Positionner le badge dans le coin supérieur droit */
    top: 0px; /* Ajustez selon vos besoins */
    right: 0px; /* Ajustez selon vos besoins */
    background-color: #28a745; /* Couleur de fond du badge (vert) */
    color: white; /* Couleur du texte */
    padding: 8px 12px; /* Espacement intérieur */
    display: flex; /* Flex pour aligner l'icône et le texte */
    align-items: center; /* Centrer verticalement */
    font-size: 14px; /* Taille de la police */
    z-index: 10; /* Assurez-vous qu'il est au-dessus des autres éléments */
}

.badge-prefacture i {
    margin-right: 5px; /* Espacement entre l'icône et le texte */
}


.fiii{
  position: absolute;
    top: 3%;
    LEFT: 2%;
    WIDTH: 100%;
}
.radio-groupp {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
}

/* Hide the default radio button */
.custom-radioo input[type="radio"] {
  display: none;
}

/* Style the label for custom radio buttons */
.custom-radioo {
  display: flex;
  align-items: center;
  cursor: pointer;
  margin: 0 10px;
  transition: all 0.3s ease;
}

/* Radio icon styles */
.radio-iconn {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

/* Radio label */
.radio-labell {
  font-size: 16px;
}

/* Colors for different statuses */
.not-found {
  background-color: lightblue;
}


.no-commande-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  text-align: center;
  background-color: #f9f9f9;
  border-radius: 10px;
  padding: 20px;
}

.no-commande-icon {
  width: 150px;
  margin-bottom: 20px;
}

.no-commande-content h3 {
  font-size: 24px;
  color: #333;
  margin-bottom: 10px;
}

.no-commande-content p {
  font-size: 16px;
  color: #666;
  margin-bottom: 20px;
}

.no-commande-content .btn-primary {
  padding: 10px 20px;
  background-color: #007bff;
  border: none;
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
}

.no-commande-content .btn-primary:hover {
  background-color: #0056b3;
}

.verified {
  background-color: lightgreen;
}

.not-verified {
  background-color: lightcoral;
}

/* Adding shadow and changing size when selected */
.custom-radioo input[type="radio"]:checked + .radio-iconn {
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
  transform: scale(1.2);
}
#pdfCard:hover, #csvCard:hover {
  transform: scale(1.05);
  border-color: #0056b3;
}

.swal2-modal{
width:38% !important;
}
#pdfPreviewIframe, #csvPreviewText {
  box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
}
/* Classe pour les lignes avec des montants égaux */
.green-background {
    background-color: #d4edda !important; /* Vert clair */
    color: #155724; /* Texte vert foncé */
}

/* Classe pour les lignes avec des montants différents */
.red-background {
    background-color: #f8d7da !important; /* Rouge clair */
    color: #721c24; /* Texte rouge foncé */
}

/* Classe pour les lignes sans correspondance */
.blue-background {
    background-color: #cce5ff !important; /* Bleu clair */
    color: #004085; /* Texte bleu foncé */
}




.styled-divider {
    margin: 20px 0;
    border: 0;
    height: 1px;
    background: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 128, 0, 0.75), rgba(0, 0, 0, 0));
  }
  
 
  
  .htContextMenu table.htCore{
    width: 290px !important;
  }

  #pdfViewer-container{
    height: 100%;
  }
  /* Styles pour le modal général */
.modall {
    display: none; /* Masqué par défaut */
    position: fixed; /* Reste à l'écran lors du défilement */
    z-index: 1000; /* Au-dessus des autres éléments */
    left: 0;
    top: 0;
    width: 100%; /* Largeur pleine */
    height: 100%; /* Hauteur pleine */
    overflow: auto; /* Activer le défilement si nécessaire */
    background-color: rgba(0, 0, 0, 0.5); /* Fond semi-transparent */
}

/* Contenu du modal */
.modal-contentt {
    background-color: #fefefe;
    padding: 20px;
    border: 1px solid #888;
    border-radius: 8px; /* Coins arrondis */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); /* Ombre */
    width: 100%; /* Largeur du modal */
    height: 95vh;

}





/* Corps du modal */
.modall-body {
    padding: 20px;
}

/* Pied du modal */
.modall-footer {
    display: flex;
    justify-content: flex-end; /* Aligner les boutons à droite */
    padding: 10px 20px; /* Espacement */
}





/* Styles pour les cartes de fichiers */
.card {
    border: 1px solid #007bff; /* Bordure de carte */
    border-radius: 8px;
    margin-bottom: 15px; /* Espacement entre les cartes */
    transition: box-shadow 0.3s ease;
}

.card:hover {
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); /* Ombre au survol */
}

.card-body {
    display: flex;
    align-items: center; /* Alignement vertical */
    justify-content: space-between; /* Espacement entre les éléments */
    padding: 10px; /* Espacement interne */
}

/* Styles pour les icônes */
.card i {
    font-size: 24px;
    color: #007bff; /* Couleur des icônes */
    margin-right: 10px; /* Espacement à droite de l'icône */
}

/* Styles pour le contenu PDF dans le modal */
.pdf-viewer {
    display: flex;
}

.pdf-viewer .pdf-preview {
    flex: 1; /* Prendre toute la largeur */
    background-color: #f8f9fa; /* Couleur de fond */
    padding: 10px; /* Espacement */
}



</style>
<!-- Modal to show PDF -->
<div class="modal fade" id="pdfPreviewModal" tabindex="-1" role="dialog" aria-labelledby="pdfPreviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body" style="width: 100%; height: 90vh">
        <div class="loading-container" ng-if="loadings">
          <div class="loading-content">
            <div class="loading-icon">
              <i class="fas fa-spinner fa-spin"></i> <!-- Icône de chargement -->
            </div>
            <h2 class="loading-title">En cours de recherche</h2>
            <p class="loading-text">Recherche de commandes...</p>
          </div>
        </div>
        
        <div class="badge-prefacture">
          <i class="fa fa-file-invoice-dollar"></i> {{prefacturenum}}
      </div>
        <div style="display: flex; height: 100%;">
          <div style="flex: 2;" id="pdfViewer-container">
            <iframe id="pdfViewer" style="width: 100%; height: 61%;" allowfullscreen webkitallowfullscreen></iframe>

            <div style="height: 32%; margin-top: 20px;">
              <h4 class="no-margin title-commandes">Commandes extraites :: {{prefacturenum}}</h4>
              <div id="CommandesTab" ></div>
            </div>
            <br>
            <div class="form-inline" style="text-align: end;">
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-addon bg-blue input-sm">
                    <i>Total H.T.</i>
                  </div>
                  <input type="text" ng-model="totalhtcsv" placeholder="Total H.T" class="form-control input-sm" ng-disabled="true">
                  <span class="input-group-addon">{{selectedClient.DeviseS}}</span>
                </div>
              </div>

              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-addon bg-blue input-sm">
                    <i>Total T.V.A.</i>
                  </div>
                  <input type="text" ng-model="totaltvacsv" placeholder="Total T.V.A" class="form-control input-sm" ng-disabled="true">
                  <span class="input-group-addon">{{selectedClient.DeviseS}}</span>
                </div>
              </div>

              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-addon bg-red input-sm">
                    <i>Total T.T.C.</i>
                  </div>
                  <input type="text" ng-model="totalttccsv" placeholder="Total T.T.C" class="form-control input-sm" ng-disabled="true">
                  <span class="input-group-addon">{{selectedClient.DeviseS}}</span>
                </div>
              </div>

             
            </div>
          </div>
          <div style="flex: 3; padding: 10px; width: 300px;">
            <div class="col-md-12">
              <div class="box box-info" >
                <div class="box-header">
                  <h4 class="no-margin title-recherche-commande">Recherche Commande :: {{prefacturenum}}</h4>
                </div>
                <div class="box-body">
                  
                  <div class="form-inline" style="display: flex; align-items: center;">
                    <div class="form-group margin-r-5">
                      <div class="input-group">
                        <div class="input-group-addon input-sm">
                          <i>Type Date : </i>
                        </div>
                        <select ng-model="DateFiltre2.filtre" ng-options="v for v in DateFiltre2.values" class="btn btn-sm btn-info dropdown-toggle"></select>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="input-group">
                        <div class="input-group-addon input-sm">
                          <i>A partir du</i>
                        </div>
                        <input type="text" class="form-control input-sm" uib-datepicker-popup="{{format}}" ng-model="Filtre.dt11" is-open="opened11" datepicker-options="dateOptions" autocomplete="off" ng-blur="parseDate($event,'dt1')">
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-sm btn-default" ng-click="opendatee($event)"><i class="fa fa-calendar"></i></button>
                        </span>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="input-group">
                        <div class="input-group-addon input-sm">
                          <i>Jusqu'à</i>
                        </div>
                        <input type="text" class="form-control input-sm" uib-datepicker-popup="{{format}}" ng-model="Filtre.dt22" is-open="opened22" datepicker-options="dateOptions2" autocomplete="off" ng-blur="parseDate($event,'dt2')">
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-sm btn-default" ng-click="opendate22($event)"><i class="fa fa-calendar"></i></button>
                        </span>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="input-group input-group-sm">
                      <div class="input-group-addon">
                      Code client
                    </div>
                        <input type="text" id="CodeCLi" ng-model="Sidebar.CodeCli" placeholder="" uib-typeahead="address.CodeClient for address in getCli($viewValue)" class="form-control input-sm">
                      </div>
                    </div>
                    <button type="button" ng-click="searchFacts()" class="btn btn-sm btn-success">Rechercher</button>

                    <div class='input-group pull-right'>
                      <div class="input-group-addon">
                        Page
                      </div>
                      <input type='text' class="form-control input-sm" size="1" ng-model='selectedPage' ui-keydown="{13:'goToPage()'}" style="width: 25px;" >
                      <div class="input-group-addon">
                         / {{maxPage}} 
                         <i ng-click="previousPagee()" class="cursorP fa fa-chevron-left"></i>
                         <i ng-click="nextPagee()" class="cursorP fa fa-chevron-right"></i>
                      </div>
                    </div>
                    <div class='input-group pull-right'>
                      <input id="search_field" class="form-control input-sm" type="text" placeholder="Recherche dans tableau">
                      <div class='input-group-addon'>
                       {{NbrVal}} / {{countFold}} Dossier(s)
                      </div>
                    </div>
                  
                    
                    <div style="display: flex; flex-direction: column; margin-left: 30px;">
                      <button type="button" ng-show="db.scans.length > 0" ng-click="generatePdf('verified')" class="btn btn-sm btn-info" style="margin-bottom: 10px;">Générer  Rapport</button>
                   
                    </div>
                   
                  </div>

                  <br>
                  <div ng-if="db.scans == null || db.scans == undefined || db.scans.length === 0" class="no-commande-container">
                    <div class="no-commande-content">
                      <img src="images/2606535_5870.jpg" alt="Aucune commande" class="no-commande-icon"/>
                      <h3>Aucune commande trouvée</h3>
                      <p>Essayez d'effectuer une recherche valide pour afficher vos commandes.</p>
                    </div>
                  </div>

            
                    
                    <div id="OrderTabb"style="display: block; height: 300px;"></div>
              

                  <hr class="styled-divider" ng-if="db.scans.length > 0">

                  <!-- Second Hot Table -->
              


                  <div>

                    <h4 class="no-margin title-nouvelle-facture">Nouvelle facture :: {{prefacturenum}}</h4> 
                    
                  <div id="SelectedTab" ></div>
                  </div>
                  <div class="col-md-12" ng-if="db.scans.length > 0">
                    <div class="overlay" ng-show="loadScanning">
                      <i class="fa fa-refresh fa-spin"></i> Chargement
                    </div>
                    <br>
                    <div class="form-inline" style="text-align: end;">
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon bg-blue input-sm">
                            <i>Total H.T.</i>
                          </div>
                          <input type="text" ng-model="totmontant" placeholder="Total H.T" class="form-control input-sm" ng-disabled="true">
                          <span class="input-group-addon">{{selectedClient.DeviseS}}</span>
                        </div>
                      </div>

                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon bg-blue input-sm">
                            <i>Total T.V.A.</i>
                          </div>
                          <input type="text" ng-model="tottva" placeholder="Total T.V.A" class="form-control input-sm" ng-disabled="true">
                          <span class="input-group-addon">{{selectedClient.DeviseS}}</span>
                        </div>
                      </div>

                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon bg-red input-sm">
                            <i>Total T.T.C.</i>
                          </div>
                          <input type="text" ng-model="totalttc" placeholder="Total T.T.C" class="form-control input-sm" ng-disabled="true">
                          <span class="input-group-addon">{{selectedClient.DeviseS}}</span>
                        </div>
                      </div>

                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon bg-red input-sm">
                            <i>Date Pièce</i>
                          </div>
                          <input type="text" class="form-control input-sm" uib-datepicker-popup="{{format}}" ng-model="DateFact" is-open="openedFact" datepicker-options="dateOptionsFact">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> 
    </div>
  </div>
</div>

<div class="form-inline">
  <div class="form-group">
    <div class="input-group">
      <div class="input-group-btn">
        <button type="button" ng-click="openFileInput()" class="btn btn-sm btn-info btn-flat">Préfacturation</button>
        <input type="file" id="fileInputPDF" ng-model="filePDF" onchange="angular.element(this).scope().onFileSelected(event, 'pdf')" accept=".pdf" style="display: none;" />
        <input type="file" id="fileInputCSV" ng-model="fileCSV" onchange="angular.element(this).scope().onFileSelected(event, 'csv')" accept=".csv" style="display: none;" />
        
        <button type="button" class="btn btn-sm btn-success dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            <i class="fa fa-file-text"></i>
          <span class="fa fa-caret-down"></span>
        </button>


        <ul class="dropdown-menu no-padding">
          <li ng-show="!isModal" ng-click="addRow();" class="btn btn-flat col-md-12 btn-default" style="cursor:pointer;text-align: left"><i class="fa fa-file-o"></i> Nouvelle Facture Vente</li>
          <li ng-show="!isModal" ng-click="addRowAn();" class="btn btn-flat col-md-12 btn-default" style="cursor:pointer;text-align: left"><i class="fa fa-file-o"></i> Nouvelle Facture Annexe</li>
          <li ng-show="!isModal" ng-click="addRowAnAv();" class="btn btn-flat col-md-12 btn-default" style="cursor:pointer;text-align: left"><i class="fa fa-file"></i> Nouvelle Facture Annexe d'avoir</li>
        </ul>
      </div>
    </div>
  </div>
  <button type="button" ng-click="cash()" class="btn btn-sm btn-yahoo" data-nq-tooltip="" data-qo-placement="bottom-left" data-qs-title="Encaisser"><i class="fa fa-money"></i> </button>
  <select ng-cloak ng-model="TypeMetier.filtre" ng-options="v for v in TypeMetier.values" ng-change="" class="btn btn-sm btn-info dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
  </select>
  <div class="input-group input-group-sm ">
    <div class="input-group-btn">
      Type Fa.
    </div>
    <select ng-cloak ng-model="statutFa.filtre" ng-options="v for v in statutFa.values" ng-change="filtreBtn();" class="btn btn-sm btn-info dropdown-toggle" data-toggle="dropdown" aria-expanded="false"></select>
  </div>

  <div class="input-group input-group-sm ">
    <div class="input-group-btn">
      <select ng-cloak ng-model="prop.filtre" ng-options="v for v in prop.values" ng-change="filtreBtn();" class="btn btn-sm btn-info dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
      </select>
    </div>
    <input type="text" ng-model="searchForm.value" placeholder="Recherche" uib-typeahead="address.theName for address in autoCompSearch($viewValue)" typeahead-loading="loadingCli" class="form-control input-sm" ui-keydown="{13:'newSearch()','113': 'keypressF2($event)'}" >
  </div>

  <select ng-cloak ng-model="DateFiltre.filtre" ng-options="v for v in DateFiltre.values" ng-show="showFiltreMore" ng-change="" class="btn btn-sm btn-info dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
  </select>

  <div class="form-group" ng-show="showFiltreMore">
    <div class="input-group" style="">
      <div class="input-group-addon">
        <i>A partir du</i>
      </div>
        <input type="text" size="9" class="form-control input-sm" uib-datepicker-popup="{{$root.formatDate}}" ng-model="Filtre.dt1" is-open="opened" min-date="" max-date="" datepicker-options="dateOptions" name="Date1" close-text="Close" ng-focus="today()" />
        <span class="input-group-btn">
        <button type="button" class="btn btn-sm btn-default" ng-click="opendate($event)"><i class="fa fa-fw fa-calendar"></i></button>
        </span>
    </div>
  </div>
  <div class="form-group" ng-show="showFiltreMore">      
    <div class="input-group" style="">
      <div class="input-group-addon">
        <i>Jusqu'au</i>
      </div>
        <input type="text" size="9" class="form-control input-sm" uib-datepicker-popup="{{$root.formatDate}}" ng-model="Filtre.dt2" is-open="opened2" min-date="Filtre.dt1" max-date="" datepicker-options="dateOptions" name="Date1" close-text="Close" />
        <span class="input-group-btn">
        <button type="button" class="btn btn-sm btn-default" ng-click="opendate2($event)"><i class="fa fa-fw fa-calendar"></i></button>
        </span>
    </div>
  </div>
  <button type="button" ng-click="newSearch()" class="btn btn-sm btn-info btn-flat">Chercher</button>

  <div class="form-group" ng-show="showRSearch">
    <button type="button" ng-click="Rsearch()" class="btn btn-sm btn-warning">Reset</button>
    <button type="button" class="btn btn-sm btn-success" ng-click="prevSearch()"><i class="fa fa-fw fa-arrow-left"></i></button>
    <button type="button" class="btn btn-sm btn-success" ng-click="nextSearch()"><i class="fa fa-fw fa-arrow-right"></i></button>    
  </div>
<!--   <div class="form-group ">
    <label for="inputSuccess" class="control-label" ng-bind-html="resultCount"></label>
  </div> -->
  <div class="pull-right">
<!--     <div class="btn-group">
      <button type="button" class="btn btn-sm btn-default btn-flat dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
        Editer
        <span class="caret"></span>
        <span class="sr-only">Toggle Dropdown</span>
      </button>
      <ul class="dropdown-menu">
        <li><a ng-click='journal();'>Grand Livre</a></li>
        <li><a ng-click='printImp();'>Relevé Fa. non réglées</a></li>
      </ul>
    </div> -->
    <div class="btn-group">
      <button type="button" class="btn btn-sm btn-default btn-flat dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
        Exporter Factures
        <span class="caret"></span>
        <span class="sr-only">Toggle Dropdown</span>
      </button>
      <ul class="dropdown-menu">
        <li><a ng-click='exportCiel();'>Export Ciel</a></li>
        <li><a ng-click='exportExcell();'>Fichier excel</a></li>
      </ul>
    </div>
  </div>
</div>
<br>
  
<div class="row" on-size-changed="logResize()">
  <div class="col-lg-9">
    <div class="box box-solid box-info">
      <div class="box-header with-border">
        <h3 class="box-title">Liste des Factures</h3>
        <div class="box-tools pull-right">
          <button type="button"  ng-click="showCmdClick()" ng-class="{'btn btn-default':!ShowCmd,'btn btn-success':ShowCmd}" data-nq-tooltip="" data-qo-placement="bottom-left" data-qs-title="Afficher le détail"><i class='fa fa-eye'></i></button>
          <button type="button"  ng-click="showFiless()"  ng-if="db.order.length>0" style="color: black;" class="btn btn-waring" data-nq-tooltip="" data-qo-placement="bottom-left" data-qs-title="Afficher les documents"><i class='fa fa-file'></i></button>
        </div>
      </div>
      <div class="box-body" ng-class="{'animateShow3':ShowCmd=== true}" style="" ng-cloak>
        <div class="form-inline">
          <button type="button" ng-click='solder()' ng-class="{'btn-default':!showCaisse,'btn-danger':showCaisse}" class="btn">Solder Facture(s)</button>
<!--           <div class="btn-group">
            <button type="button" class="btn btn-default btn-flat dropdown-toggle" ng-disabled="waitSelect" data-toggle="dropdown" aria-expanded="false">
              E-Mail / documents(s) / Com...
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a ng-click='addCom();'>Ajouter commentaires</a></li>
              <li><a ng-click='newMail();'>Nouvel e-mail</a></li>
              <li><a ng-click=''>Importer document</a></li>
            </ul>
          </div> -->
          <div class="btn-group">
            <button type="button" class="btn btn-default btn-flat dropdown-toggle" ng-disabled="waitSelect" data-toggle="dropdown" aria-expanded="false">
              Action
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a ng-disabled='allselected.length!==1' ng-click='delFac();'>Dévalider la Facture</a></li>
              <li class='divider'></li>
              <li><a ng-click='setNoIrr();'>Recouvrable</a></li>
              <li><a ng-click='setIrr();'>Irrécouvrable</a></li>
            </ul>
          </div>
          <div class="btn-group">
            <button type="button" class="btn btn-default btn-flat dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
              Editer
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a ng-click='printFac();'>Facture(s)</a></li>
              <li class='divider'></li>
              <li><a tabindex="-1" href="#">Traite</a></li>
              <li><a tabindex="-1" href="#">Traite + Relevé</a></li>          
              <li class='divider'></li>
              <li><a ng-click='journal();'>Grand Livre</a></li>
              <!-- <li><a ng-click='printImp();'>Relevé Fa. non réglées</a></li> -->
<!--               <li>
                <a ng-click=''>Traite</a>
                <ul class="dropdown-menu">
                  <li><a ng-click='traiteR(0);'>Imprimer Traite</a></li>
                  <li><a ng-click='traiteR(1);'>Traite + Relevé</a></li>
                </ul>
              </li> -->
            </ul>
          </div>

<!--           <div class="btn-group" >
            <button type="button" class="btn btn-default btn-flat dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
              Traite
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a ng-click='traiteR(0);'>Imprimer Traite</a></li>
              <li><a ng-click='traiteR(1);'>Traite + Relevé</a></li>
            </ul>
          </div> -->

          <div class="btn-group">
            <button type="button" class="btn btn-default btn-flat dropdown-toggle" auto-close="always" data-toggle="dropdown" aria-expanded="false">
              Relance
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a ng-click='printRel("synthese");'>Imprimer synthèse</a></li>
              <li class='divider'></li>
              <li><a ng-click='printRel("relance1");'>Imprimer Relance 1</a></li>
              <li><a ng-click='printRel("relance2");' ng-disabled="disRel2">Imprimer Relance 2</a></li>
              <li class='divider'></li>
              <li><a ng-click='printRel("miseEnDemeure");' ng-disabled="disRel3">Mise en demeure</a></li>
              <li><a ng-click='gayssot();' ng-disabled="disRel3">Loi GAYSSOT</a></li>
            </ul>
          </div>


          <div class="btn-group">
            <button type="button" class="btn btn-default btn-flat dropdown-toggle" auto-close="always" data-toggle="dropdown" aria-expanded="false">
              Courier
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li class='divider'></li>
              <li><a ng-click='newCourier("Normal");'>Courier Normal</a></li>
              <li class='divider'></li>

              <li><a ng-click='newCourier("Recommandé");' ng-disabled="disRel2">Courier Recomandé </a></li>
  
            </ul>
          </div>


          <span class="pull-right">

            <div class="btn-group">
              <button type="button" ng-class="{'btn btn-default':!ctrlBtn,'btn btn-success':ctrlBtn}" class="btn btn-default btn-flat dropdown-toggle" auto-close="always" data-toggle="dropdown" aria-expanded="false">
                <i class='fa fa-bars'></i>
                <span class="caret"></span>
                <span class="sr-only">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu">
                <li><a ng-click="ctrlBtn=!ctrlBtn" ng-class="{'btn btn-default':!ctrlBtn,'btn btn-success':ctrlBtn}">Activer / Désactiver multiséléction</a></li>
                <li class='divider'></li>
                <li><a ng-click='resetSelect();'>Remettre A zéro</a></li>
                <!--<li><a ng-click='printRel("miseEnDemeure");' ng-disabled="disRel3">Mise en demeure</a></li>
                <li><a ng-click='printRel("Gayssot");' ng-disabled="disRel3">Loi GAYSSOT</a></li> -->
              </ul>
            </div>

              <!-- <button type="button"  ng-click="ctrlBtn=!ctrlBtn" ng-class="{'btn btn-default':!ctrlBtn,'btn btn-success':ctrlBtn}" data-nq-tooltip="" data-qo-placement="bottom-left" data-qs-title="Activer / Désactiver multiséléction"><i class='fa fa-bars'></i> {{allselected}}</button> -->
          </span>

          <div class='col-md-2 input-group pull-right'>
            <div class="input-group-addon">
              Page
            </div>
            <input type='number' ui-keydown="{13:'search()'}" class="form-control input-sm input-sm-7" ng-model='thePage' min='1' max='{{totalPages}}'>
            <div class="input-group-addon">
               / {{totalPages}}  
               <i ng-click="prevPage()" class="cursorP fa fa-chevron-left"></i>
               <i ng-click="nextPage()" class="cursorP fa fa-chevron-right"></i>
            </div>
          </div>
          <div class='input-group pull-right'>
            <input id="search_field" class="form-control input-sm" type="text" placeholder="Recherche dans tableau" style="width: 30px;">
            <div class='input-group-addon'>
             {{NbrVal}} / {{countFold}} Facture(s)
            </div>
          </div>
        </div>

        <div class="form-inline">
          <tags-input ng-model="tags" ng-show='false' on-tag-removed="removeSelec($tag)" on-tag-added="addSelect($tag)" min-length="0" add-from-autocomplete-only="true" display-property="NumFact">
            <auto-complete min-length="0" source="db.fact"></auto-complete>
          </tags-input>
        </div>
        <br>
        <div class="row">
          <div class="col-md-12">
            <hot-table hot-id="tableFAV" settings="hotFact.setting" datarows="db.fact" ></hot-table>
          </div>
        </div>
      </div>
      <div class='box-footer' ng-show='allselected>0'>
        <div class="form-inline text-right">
          <div class="form-group">
            <b>{{allselected}} Factures(s) séléctionnée(s) <i class="fa fa-eye" ng-click="showSelec()"></i></b>
          </div>
          <div class="form-group">
            <div class="input-group">
              <div class="input-group-addon">Total H.T</div>
              <input type="text" class="form-control" ng-disabled="true" ng-model="faTotalHt">
              <div class="input-group-addon">€</div>
            </div>
          </div>
          <div class="form-group">
            <div class="input-group">
              <div class="input-group-addon">Total T.V.A</div>
              <input type="text" class="form-control" ng-disabled="true" ng-model="faTotalTva">
              <div class="input-group-addon">€</div>
            </div>
          </div>
          <div class="form-group">
            <div class="input-group">
              <div class="input-group-addon">Total T.T.C</div>
              <input type="text" class="form-control" ng-class="{'input-success':canSolde}" ng-disabled="true" ng-model="faTotalTtc">
              <div class="input-group-addon">€</div>
            </div>
          </div>
        </div>
      </div>
      <div class="overlay" ng-show="loadingFact">
        <i class="fa fa-refresh fa-spin"></i>
      </div>
    </div>
    <div  ng-class="{'animateShow3':ShowCmd=== true, 'animateHide': ShowCmd===false}" >
      <div class="box box-solid box-info">

        <div class="box-header with-border">
          <h3 class="box-title">Détails de la Facture {{NumFact}}</h3>
          <div class="box-tools pull-right">
            <button type="button" ng-click='downFile()' ng-disabled="!selectedFa" class="btn btn-default"><i class="fa fa-file-archive-o"></i></button>
            <!-- <button type="button" ng-click='supCmd()' ng-disabled="!selectedFa" class="btn btn-warning">Supprimer Commande</button> -->
          </div>
        </div>
<!--         <div class="box-header with-border">
          <span>Detail de la Facture</span><br>
          <button type="button" ng-click='newCmd()' ng-disabled="!selectedFa" class="btn btn-default">Ajouter Commande</button>
          <button type="button" ng-click='supCmd()' ng-disabled="!selectedFa" class="btn btn-warning">Supprimer Commande</button>
        </div> -->
        <div class="box-body" style="line-height:7px;width: 100%; height: 100%;overflow: hidden;">
            <hot-table hot-id="OrderTab" settings="hotOrder.setting" datarows="db.order"  style="display: block;height: 300px;"></hot-table>
  <!--         <div ng-show="!ShowAv">
          </div>
          <div ng-show="ShowAv">
          </div> -->
          <!-- <div id="OrderTab"></div> -->
        </div>
        <div class="overlay" ng-show="loadingDetail">
          <i class="fa fa-refresh fa-spin"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3" ng-show='!showCaisse'>
    <div id="divAff" class="box box-solid box-info">
      <div class="box-header with-border">
        <h3 class="box-title">Client</h3>
        <div class="box-tools pull-right">
              <button type="button" ng-focus='boxFocus()' class="btn btn-default"  ng-click="showCli()"> <i class="fa fa-info"></i> </button>
              <button type="button" ng-focus='boxFocus()' class="btn btn-default"  ng-click="listContact()"> <i class="fa fa-users"></i> </button>
        </div>
      </div>
      <div class="box-body" style="line-height:7px;">
        <div class="row">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-addon">
                Nom
              </span>
              <input type="text" class="form-control input-sm" ng-model="cli.Nom" ng-disabled="true">
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-addon">
                Caisse
              </span>
              <input type="text" class="form-control input-sm" ng-model="cli.Auxiliaire" ng-disabled="true">
            </div>
          </div>
        </div>
        <br>
        <div class="row">
          <div class='col-lg-10' style='padding-left:0'>
          <div class="col-lg-5">
            <div class="input-group">
              <span class="input-group-addon">
                CP
              </span>
              <input type="text" ng-focus='boxAffFocus()' class="form-control input-sm" ng-model="cli.CodePostal" ng-disabled="true">
            </div>
          </div>
          <div class="col-lg-7" style='padding-right:0'>
            <div class="input-group">
              <span class="input-group-addon">
                V.
              </span>
              <input type="text" ng-focus='boxAffFocus()' class="form-control input-sm" ng-model="cli.Ville" ng-disabled="true">
            </div>
          </div>
        </div>
          <div class="col-lg-2">
            <div class="input-group">
              <input type="text" ng-focus='boxAffFocus()' class="form-control input-sm" ng-model="cli.CodePays" ng-disabled="true">
            </div>
          </div>
        </div>
        <br>
        <div class="row">
          <div class="col-lg-6">
            <div class="input-group">
              <span class="input-group-addon">
                Avoir
              </span>
              <input type="text" class="form-control input-sm" ng-model="cli.Solde" ng-disabled="true">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="input-group">
              <span class="input-group-addon">
                Encours
              </span>
              <input type="text" class="form-control input-sm" ng-model="cli.Solde2" ng-disabled="true">
            </div>
          </div>
        </div>
    
      </div>
      <div class="overlay" ng-show="loadingDetail">
        <i class="fa fa-refresh fa-spin"></i>
      </div>
    </div>

    <div class="box box-solid box-info">
      <div class="box-header with-border">
        <h3 class="box-title">Suivi facture</h3>
        <div class="btn-group">
          <button ng-disabled="!selectedFa" type="button" ng-class="{'btn btn-default':!ctrlBtn,'btn btn-success':ctrlBtn}" class="btn btn-default btn-flat dropdown-toggle no-border" auto-close="always" data-toggle="dropdown" aria-expanded="false">
            <i class='fa fa-plus'></i>
            <span class="caret"></span>
            <span class="sr-only">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu no-padding">
            <li><a class="btn btn-default text-black" style="text-align:left" ng-click="addCom()"><i class="fa fa-comment"></i> Ajouter commentaires</a></li>
            <li><a class="btn btn-default text-black" style="text-align:left" ng-click='newMail();'><i class="fa fa-envelope"></i> Nouvel e-mail</a></li>
            <li><a class="btn btn-default text-black" style="text-align:left" ng-click='newFile()'><i class="fa fa-file"></i> Importer document</a></li>
          </ul>
        </div>
        <div class="box-tools pull-right">
          <button class="btn btn-default" ng-disabled="waitSelect" ng-class="{'text-green':suivieFile ===true}" ng-click="suivieFile = !suivieFile"><i class="fa fa-file-text"></i></button>
          <button class="btn btn-default" ng-disabled="waitSelect" ng-class="{'text-green':suivieMail ===true}" ng-click="suivieMail = !suivieMail"><i class="fa fa-envelope"></i></button>
          <button class="btn btn-default" ng-disabled="waitSelect" ng-class="{'text-green':suivieCom ===true}" ng-click="suivieCom = !suivieCom"><i class="fa fa-comment"></i></button>
          <!-- <button class="btn btn-success" ng-disabled="waitSelect" ng-click="addCom()"><i class="fa fa-file-text"></i></button> -->
          <!-- <button class="btn btn-box-tool" id='comCollapse' ng-keydown="keypressNext($event);" ng-click="collapseSolde()" data-widget="collapse"><i class="fa fa-minus"></i></button> -->
        </div>
      </div>
      <div class="box-body boxTimeLine">
<!--         <h4>
          Documents joints 
          <label class="control-label" ng-bind-html="db.files.length"></label>
        </h4>
        <div style="max-height:150px;overflow: auto;">
          <h3 class="text-center" ng-show="db.files.length===0">Aucun Document</h3>
          <ul class="list-group">
              <li ng-repeat="file in db.files track by $index" class="list-group-item">
                  <span class="">
                    <img ng-src="{{file.Folder}}{{file.Identifier}}.{{file.Extension}}" alt="user avatar" class="img-circle img-md">
                    <div class="timeline-item">
                        <span class="time"><i class="fa fa-clock-o"></i> {{file.createdAt | date:'dd/MM/yyyy h:mma'}}</span>
                        <h4 class="timeline-header"><a ng-click='showFile($index)'>{{file.Name}}  {{file.Size}}</a></h4>
                    </div>
                  </span>
              </li>
          </ul>
        </div> -->

<!--         <h4>
          Commentaires  
          <label class="control-label" ng-bind-html="db.com.length"></label>
        </h4> -->
        <div style="overflow: auto;">
          <h3 class="text-center" ng-show="suivie.length===0">Aucun commentaire</h3>
          <!-- <hot-table hot-id="comTab" settings="hotCom.setting" datarows="db.com" ></hot-table> -->
          <ul class="timeline">
              <!-- timeline time label -->
              <li ng-repeat-start="jour in suivie" class="time-label">
                  <span class="bg-red">
                      {{jour.date}}
                  </span>
              </li>
              <!-- /.timeline-label -->

              <!-- timeline item -->
              <li ng-repeat="datas in jour.data | filter:trackFilter track by $index" ng-repeat-end>
                <img ng-if="datas.type=='com'" ng-src="/images/users/{{datas.com.createdBy.avatar}}" err-src="/images/users/homme.png" alt="user avatar" class="img-circle img-md">

                <div ng-if="datas.type=='com'" class="timeline-item">
                    <span class="time"><i class="fa fa-clock-o"></i> {{datas.com.createdAt | date:'h:mma'}}</span>

                    <h3 class="timeline-header"><a href="#">{{datas.com.createdBy.firstname}} {{datas.com.createdBy.lastname}}</a></h3>

                    <div class="timeline-body" ng-bind-html="datas.com.Com"></div>

                </div>

                <i ng-if="datas.type=='mail'" class="img-circle img-md fa fa-envelope bg-orange"></i>

                <div ng-if="datas.type=='mail'" class="timeline-item">
                    <span class="time"><i class="fa fa-clock-o"></i> {{datas.mail.createdAt | date:'h:mma'}}</span>

                    <h3 class="timeline-header"><a><i>{{datas.mail.To}}</i><br> <b>{{datas.mail.Subject}}</b></a></h3>
                    <div class="timeline-body" >
                      <div ng-bind-html="datas.mail.TextHtml"></div>
                      <div>
                        <b>Fichiers Joints</b>                    
                        <div class="row">
                          <table class="table ">
                            <tbody>
                              <tr ng-repeat="file in datas.mail.Attachment">
                                <td ng-click="showFile(file)">- {{file.filename}}</td>
                                <!-- <td class="text-center"><i class="fa fa-eye" ng-click="showFile(file)"></i></td> -->
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                </div>

                <i ng-if="datas.type=='file'" class="img-circle img-md fa fa-file bg-olive-active"></i>
                <div ng-if="datas.type=='file'" class="timeline-item">
                    <span class="time"><i class="fa fa-clock-o"></i> {{datas.file.createdAt | date:'dd/MM/yyyy h:mma'}}</span>
                    <h4 class="timeline-header"><a ng-click='showFile(datas.file)'>{{datas.file.Name}}  {{datas.file.Size}}</a></h4>
                </div>
              </li>
          </ul>
        </div>
      </div>
      <div class="overlay" ng-show="loadingSuivie">
        <i class="fa fa-refresh fa-spin"></i>
      </div>
    </div>
  </div>
  <div class="col-md-3" on-size-changed="logResize()" ng-show="showCaisse">

    <div class="box box-solid box-danger">
      <div class="box-header with-border">
        <h3 class="box-title">Solde Facture</h3>
<!--         <div class="box-tools pull-right">
          <button class="btn btn-box-tool" id='soldeCollapse' ng-keydown="keypressNext($event);" ng-click="collapseCom()" data-widget="collapse"><i class="fa fa-plus"></i></button>
        </div> -->
      </div>
      <div class="box-body" style="">
        <hot-table hot-id="soldeTab" settings="hotSolde.setting" datarows="db.solde" ></hot-table>
        <!-- <div id='soldeTab'></div> -->
      </div>
      <div class='box-footer'>
        <div class="form-group">
          <div class="input-group">
            <div class="input-group-addon">Total Solde</div>
            <input type="text" class="form-control" ng-disabled="true" ng-model="soldeTotalTtc" placeholder="">
            <div class="input-group-addon">€</div>
          </div>
        </div>
      </div>
      <div class="overlay" ng-show="loadingDetail">
        <i class="fa fa-refresh fa-spin"></i>
      </div>
    </div>

    <div id="divAff" class="box box-solid box-warning">
      <div class="box-header with-border">
        <h3 class="box-title">Caisse</h3>
      </div>
      <div class="box-body" style="line-height:7px;">
        <div class="row" ng-show="!sameCaisse">
          <h3 class="text-center">{{caisseError}}</h3>
        </div>
        <div class='form-group' ng-show="sameCaisse">
          <div class="input-group">
            <div class="input-group-addon">
              Code Caisse
            </div>
              <!-- {{caisseNom}} -->
            <input type="text" class="form-control" ng-model="caisseNom" ng-disabled="true">
          </div>          
        </div>
        <div class="row" ng-show="sameCaisse">
 <!--          <h3 class="text-center">
            Encaissement(s) disponible(s)
          </h3> -->
          <div class="col-md-12">
            <hot-table hot-id="tableCaisse" settings="hotCaisse.setting" datarows="db.caisseDatas" ></hot-table>
          </div>
        </div>
      </div>
      <div class="box-footer" ng-show="sameCaisse">
        <div class="col-md-10">
          <div class='form-group'>
            <div class="input-group">
              <div class="input-group-addon">
                Total Séléction 
              </div>
              <input type="text" class="form-control" ng-model="caisseTotal" ng-disabled="true">
              <div class="input-group-addon">
                €
              </div>
            </div>          
          </div>
        </div>    
        <div>
          <button type="button" class="btn btn-success pull-right" ng-disabled="!btnValidSold" ng-click="validSolde()">Valider</button>
        </div>
      </div>
    </div>
  </div>
</div>